(function(t){"use strict";function e(e,a,i){function r(){h.handshake(),p||(i(h),p=!0)}"function"==typeof a&&(i=a,a={}),i||(i=o);var l=a&&1===a.nodeType?a:a.el||document.querySelector("body");a.el=null;var c=document.createElement("iframe"),h=new s(c,a);t.addEventListener("message",h.messageHandler.bind(h),!1),n.push(c),c.setAttribute("scrolling","no"),c.setAttribute("src",e);var p=!1;c.addEventListener("load",r,!1),l.appendChild(c)}function s(t,e){if(this.iframe=t,this.callbacks={},this.eventQ={load:[],evaljs:[],html:[]},e.sandbox===!0)this.sandbox="allow-scripts allow-same-origin";else if("string"==typeof e.sandbox){var s=e.sandbox;-1===s.indexOf("allow-scripts")&&(s+=" allow-scripts"),-1===s.indexOf("allow-same-origin")&&(s+=" allow-same-origin"),this.sandbox=s}else this.sandbox=null;this.secret=Math.ceil(999999999*Math.random())+1}var n=[],o=function(){};e.clear=function(){n.forEach(function(t){var e=t.parentElement;e&&e.removeChild(t)}),n=[]},s.prototype.handle=function(t,e){var s,n=this;if("custom"===t){var o=e;s=this.callbacks[o.type]||[],s.forEach(function(t){"function"==typeof t&&t.call(t.thisArg||n,o.data)})}else{if(s=this.eventQ[t],!s)return;var a=s.shift();"function"==typeof a&&a.call(a.thisArg||n,e)}},s.prototype.messageHandler=function(t){var e;try{e=JSON.parse(t.data)}catch(s){return}if(e.secret===this.secret){var n=e.data,o=e.type;this.handle(o,n)}},s.prototype.post=function(t,e){this.iframe.contentWindow.postMessage(JSON.stringify({type:t,data:e,secret:this.secret}),"*")},s.prototype.evaljs=function(e,s,n){var a=function(e){var n,a=e.error,i=a;a&&(n=t[a.__errorType__])&&(i=new n(a.message),i.stack=a.stack,i.type=a.type,i.arguments=a.arguments),(s||o).call(this,i,e.result)};a.thisArg=n,this.eventQ.evaljs.push(a),this.post("evaljs",e)},s.prototype.load=function(t,e,s){e=e||o,e.thisArg=s,this.eventQ.load.push(e),this.post("load",t)},s.prototype.html=function(t,e){t=t||o,t.thisArg=e,this.eventQ.html.push(t),this.post("html",null)},s.prototype.handshake=function(){this.post("handshake",this.sandbox)},s.prototype.on=function(t,e,s){e=e||o,e.thisArg=s,this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},s.prototype.off=function(t,e){var s=this.callbacks[t];if(s){var n=s.indexOf(e);-1!==n&&s.splice(n,1)}else this.callbacks[t]=[]},s.prototype.emit=function(t,e){this.post("_custom_"+t,e)},e.Context=s,"object"==typeof module&&module&&(module.exports=e),t.stuff=e})(window);