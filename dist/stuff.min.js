(function(t){"use strict";function e(e,i,o){function r(){h.handshake(),p||(o(h),p=!0)}"function"==typeof i&&(o=i,i={}),o||(o=n);var l=i&&1===i.nodeType?i:i.el||document.querySelector("body");i.el=null;var c=document.createElement("iframe"),h=new s(c,i);t.addEventListener("message",h.messageHandler.bind(h),!1),a.push(c),c.setAttribute("scrolling","no"),c.setAttribute("src",e);var p=!1;c.addEventListener("load",r,!1),l.appendChild(c)}function s(t,e){if(this.iframe=t,this.callbacks={},this.eventQ={load:[],evaljs:[],html:[]},e.sandbox===!0)this.sandbox="allow-scripts allow-same-origin";else if("string"==typeof e.sandbox){var s=e.sandbox;-1===s.indexOf("allow-scripts")&&(s+=" allow-scripts"),-1===s.indexOf("allow-same-origin")&&(s+=" allow-same-origin"),this.sandbox=s}else this.sandbox=null;this.secret=Math.ceil(999999999*Math.random())+1}var a=[],n=function(){};e.clear=function(){a.forEach(function(t){var e=t.parentElement;e&&e.removeChild(t)}),a=[]},s.prototype.handle=function(t,e){var s,a=this;if("custom"===t){var n=e;s=this.callbacks[n.type]||[],s.forEach(function(t){"function"==typeof t&&t.call(t.thisArg||a,n.data)})}else{if(s=this.eventQ[t],!s)return;var i=s.shift();"function"==typeof i&&i.call(i.thisArg||a,e)}},s.prototype.messageHandler=function(t){var e;try{e=JSON.parse(t.data)}catch(s){return}if(e.secret===this.secret){var a=e.data,n=e.type;this.handle(n,a)}},s.prototype.post=function(t,e){this.iframe.contentWindow.postMessage(JSON.stringify({type:t,data:e,secret:this.secret}),"*")},s.prototype.evaljs=function(e,s,a){var i=function(e){var a,i=e.error,o=i;i&&(a=t[i.__errorType__])&&(o=new a(i.message),o.stack=i.stack,o.type=i.type,o.arguments=i.arguments),(s||n).call(this,o,e.result)};i.thisArg=a,this.eventQ.evaljs.push(i),this.post("evaljs",e)},s.prototype.load=function(t,e,s){e=e||n,e.thisArg=s,this.eventQ.load.push(e),this.post("load",t)},s.prototype.html=function(t,e){t=t||n,t.thisArg=e,this.eventQ.html.push(t),this.post("html",null)},s.prototype.handshake=function(){this.post("handshake",this.sandbox)},s.prototype.on=function(t,e,s){e=e||n,e.thisArg=s,this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},s.prototype.off=function(t,e){var s=this.callbacks[t];if(s){var a=s.indexOf(e);-1!==a&&s.splice(a,1)}else this.callbacks[t]=[]},s.prototype.emit=function(t,e){this.post("_custom_"+t,e)},e.Context=s,t.stuff=e})(this);